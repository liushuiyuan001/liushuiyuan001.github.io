import{o as n,c as a,a as s,d as t}from"./app.3fe4aed4.js";const o='{"title":"10 双端比较","description":"","frontmatter":{},"headers":[{"level":2,"title":"10.1 双端比较的原理","slug":"_10-1-双端比较的原理"},{"level":2,"title":"处理新增和删除情况","slug":"处理新增和删除情况"}],"relativePath":"vuejs/10.md","lastUpdated":1662271193176}',e={},p=[s("h1",{id:"_10-双端比较",tabindex:"-1"},[t("10 双端比较 "),s("a",{class:"header-anchor",href:"#_10-双端比较","aria-hidden":"true"},"#")],-1),s("h2",{id:"_10-1-双端比较的原理",tabindex:"-1"},[t("10.1 双端比较的原理 "),s("a",{class:"header-anchor",href:"#_10-1-双端比较的原理","aria-hidden":"true"},"#")],-1),s("p",null,"双端比较通过定义新旧节点的开始下标与结束下标四个变量。然后进行对比",-1),s("ol",null,[s("li",null,"新节点开始下标的节点和旧节点开始下标的节点对比"),s("li",null,"新节点结束下标的节点和旧节点结束下标的节点对比"),s("li",null,"新节点结束下标的节点和旧节点开始下标的节点对比"),s("li",null,"新节点开始下标的节点和旧节点结束下标的节点对比")],-1),s("img",{src:"/assets/10.1.1.a63ed334.png",alt:"10.1.1",style:{zoom:"80%"}},null,-1),s("p",null,"代码如下",-1),s("div",{class:"language-javascript"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"function"),t(),s("span",{class:"token function"},"patchKeyedChildren"),s("span",{class:"token punctuation"},"("),s("span",{class:"token parameter"},[t("n1"),s("span",{class:"token punctuation"},","),t("n2"),s("span",{class:"token punctuation"},","),t("container")]),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"{"),t("\n  "),s("span",{class:"token keyword"},"const"),t(" oldChildren "),s("span",{class:"token operator"},"="),t(" n1"),s("span",{class:"token punctuation"},"."),t("children\n  "),s("span",{class:"token keyword"},"const"),t(" newChildren "),s("span",{class:"token operator"},"="),t(" n2"),s("span",{class:"token punctuation"},"."),t("children\n  "),s("span",{class:"token comment"},"// 四个索引值"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" oldStartIdx "),s("span",{class:"token operator"},"="),t(),s("span",{class:"token number"},"0"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" oldEndIdx "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"."),t("length "),s("span",{class:"token operator"},"-"),t(),s("span",{class:"token number"},"1"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" newStartIdx "),s("span",{class:"token operator"},"="),t(),s("span",{class:"token number"},"0"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" newEndIdx "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"."),t("length "),s("span",{class:"token operator"},"-"),t(),s("span",{class:"token number"},"1"),t("\n  "),s("span",{class:"token comment"},"// 四个索引指向的vnode节点"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" oldStartVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),t("oldStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" oldEndVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),t("oldEndIdx"),s("span",{class:"token punctuation"},"]"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" newStartVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),t("newStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n  "),s("span",{class:"token keyword"},"let"),t(" newEndVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),t("newEndIdx"),s("span",{class:"token punctuation"},"]"),t("\n  "),s("span",{class:"token keyword"},"while"),s("span",{class:"token punctuation"},"("),t("oldStarIdx "),s("span",{class:"token operator"},"<="),t(" oldEndIdx "),s("span",{class:"token operator"},"&&"),t(" newStartIdx "),s("span",{class:"token operator"},"<="),t(" newEndIdx"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n      "),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("oldStartVNode"),s("span",{class:"token punctuation"},"."),t("key "),s("span",{class:"token operator"},"==="),t(" newStartVNode"),s("span",{class:"token punctuation"},"."),t("key"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"{"),t("\n        "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),t("oldEndVNode"),s("span",{class:"token punctuation"},","),t("newEndVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},")"),t("\n        "),s("span",{class:"token comment"},"// 不需要移动dom 移动下标和元素即可"),t("\n        oldStartVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("oldStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n        newStartVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("newStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n      "),s("span",{class:"token punctuation"},"}"),t(),s("span",{class:"token keyword"},"else"),t(),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("oldEndVNode"),s("span",{class:"token punctuation"},"."),t("key "),s("span",{class:"token operator"},"==="),t(" newEndVNode"),s("span",{class:"token punctuation"},"."),t("key"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n        "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),t("oldEndVNode"),s("span",{class:"token punctuation"},","),t("newEndVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},")"),t("\n        "),s("span",{class:"token comment"},"// 也不需要移动"),t("\n        oldEndVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"--"),t("oldStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n        oldStartVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"--"),t("newStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n      "),s("span",{class:"token punctuation"},"}"),t(),s("span",{class:"token keyword"},"else"),t(),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("oldStartVNode"),s("span",{class:"token punctuation"},"."),t("key "),s("span",{class:"token operator"},"==="),t(" newEndVNode"),s("span",{class:"token punctuation"},"."),t("key"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n        "),s("span",{class:"token comment"},"// 进行patch"),t("\n        "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),t("oldStartVNode"),s("span",{class:"token punctuation"},","),t("newEndVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},")"),t("\n        "),s("span",{class:"token comment"},"// 因为旧的开始变为新的结束 因此需要将"),t("\n        "),s("span",{class:"token function"},"insert"),s("span",{class:"token punctuation"},"("),t("oldStartVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},","),t("oldEndVNode"),s("span",{class:"token punctuation"},"."),t("el"),s("span",{class:"token punctuation"},"."),t("nextSibing"),s("span",{class:"token punctuation"},")"),t("\n        "),s("span",{class:"token comment"},"// 移动下标 更新元素"),t("\n        oldStartVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("oldStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n      "),s("span",{class:"token punctuation"},"}"),t(),s("span",{class:"token keyword"},"else"),t(),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("oldEndVNode"),s("span",{class:"token punctuation"},"."),t("key "),s("span",{class:"token operator"},"==="),t(" newStartVNode"),s("span",{class:"token punctuation"},"."),t("key"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n        "),s("span",{class:"token comment"},"// 先进行patch"),t("\n        "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),t("oldEndVNode"),s("span",{class:"token punctuation"},","),t("newStartVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},")"),t("\n        "),s("span",{class:"token comment"},"// 再进行移动DOM操作"),t("\n        "),s("span",{class:"token comment"},"// 因为旧的最后一个变成新的第一个，因为需要移动到第一个元素前面"),t("\n        "),s("span",{class:"token function"},"insert"),s("span",{class:"token punctuation"},"("),t("oldEndVNode"),s("span",{class:"token punctuation"},"."),t("el"),s("span",{class:"token punctuation"},","),t(" container"),s("span",{class:"token punctuation"},","),t(" oldStartVNode"),s("span",{class:"token punctuation"},"."),t("el"),s("span",{class:"token punctuation"},")"),t("\n\n        "),s("span",{class:"token comment"},"//移动下标和元素"),t("\n        oldEndVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"--"),t("oldEndIdx"),s("span",{class:"token punctuation"},"]"),t("\n        newStartVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("newStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n      "),s("span",{class:"token punctuation"},"}"),t(" \n  "),s("span",{class:"token punctuation"},"}"),t("\n"),s("span",{class:"token punctuation"},"}"),t("\n")])])],-1),s("h2",{id:"处理新增和删除情况",tabindex:"-1"},[t("处理新增和删除情况 "),s("a",{class:"header-anchor",href:"#处理新增和删除情况","aria-hidden":"true"},"#")],-1),s("ol",null,[s("li",null,[s("p",null,"处理在循环内部"),s("p",null,"在while循环中增加一个else处理在新节点在旧节点的情况"),s("div",{class:"language-javascript"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"const"),t(" idxInOld "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"findIndex"),s("span",{class:"token punctuation"},"("),s("span",{class:"token parameter"},"node"),t(),s("span",{class:"token operator"},"=>"),t(" node"),s("span",{class:"token punctuation"},"."),t("key "),s("span",{class:"token operator"},"==="),t(" newStartVNode"),s("span",{class:"token punctuation"},"."),t("key"),s("span",{class:"token punctuation"},")"),t("\n"),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("idxInOld "),s("span",{class:"token operator"},">"),t(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n  "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),t("oldChildren"),s("span",{class:"token punctuation"},"["),t("idxInOld"),s("span",{class:"token punctuation"},"]"),s("span",{class:"token punctuation"},","),t("newStartVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},")"),t("\n  "),s("span",{class:"token comment"},"// 将元素移动到最前面"),t("\n  "),s("span",{class:"token function"},"insert"),s("span",{class:"token punctuation"},"("),t("oldChildren"),s("span",{class:"token punctuation"},"["),t("idxInOld"),s("span",{class:"token punctuation"},"]"),s("span",{class:"token punctuation"},"."),t("el"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},","),t(" oldStartVNode"),s("span",{class:"token punctuation"},"."),t("el"),s("span",{class:"token punctuation"},")"),t("\n  "),s("span",{class:"token comment"},"// 由于idxInOld 对应元素已经移动 所以需要将原来的位置对应元素置为undefined"),t("\n  oldChildren"),s("span",{class:"token punctuation"},"["),t("idxInOld"),s("span",{class:"token punctuation"},"]"),t(),s("span",{class:"token operator"},"="),t(),s("span",{class:"token keyword"},"undefined"),t("\n  newStartVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("newStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n"),s("span",{class:"token punctuation"},"}"),t(),s("span",{class:"token keyword"},"else"),t(),s("span",{class:"token punctuation"},"{"),t("\n  "),s("span",{class:"token comment"},"// 将newStartVNode作为新节点挂载到头部，使用当前头部节点 oldStartVNode.el作为锚点"),t("\n  "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"null"),s("span",{class:"token punctuation"},","),t("newStartVNode"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},")"),t("\n  newStartVNode "),s("span",{class:"token operator"},"="),t(" newChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("newStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n"),s("span",{class:"token punctuation"},"}"),t("\n")])])]),s("p",null,"因为旧节点可能出现undefined情况，因此需要跳过旧节点为假的情况，需要在循环内最前面添加判断"),s("div",{class:"language-javascript"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),s("span",{class:"token operator"},"!"),t("oldStartVNode"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n  oldStartVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"++"),t("oldStartIdx"),s("span",{class:"token punctuation"},"]"),t("\n"),s("span",{class:"token punctuation"},"}"),t(),s("span",{class:"token keyword"},"else"),t(),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),s("span",{class:"token operator"},"!"),t("oldEndVNode"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n  oldEndVNode "),s("span",{class:"token operator"},"="),t(" oldChildren"),s("span",{class:"token punctuation"},"["),s("span",{class:"token operator"},"--"),t("oldEndIdx"),s("span",{class:"token punctuation"},"]"),t("\n"),s("span",{class:"token punctuation"},"}"),t("\n")])])])]),s("li",null,[s("p",null,"处理循环外部的新增和删除情况"),s("p",null,"首先看新增情况，如果新节点开始下标小于新节点结束下标，因此在循环后面增加判断"),s("div",{class:"language-javascript"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("newStartIdx "),s("span",{class:"token operator"},"<="),t(" newEndIdx "),s("span",{class:"token operator"},"&&"),t(" oldStartIdx "),s("span",{class:"token operator"},">"),t(" oldEndIdx"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n  "),s("span",{class:"token keyword"},"for"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"let"),t(" i "),s("span",{class:"token operator"},"="),t(" newStartIdx"),s("span",{class:"token punctuation"},";"),t(" i "),s("span",{class:"token operator"},"<="),t(" newEndIdx"),s("span",{class:"token punctuation"},";"),t("i"),s("span",{class:"token operator"},"++"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n    "),s("span",{class:"token function"},"patch"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"null"),s("span",{class:"token punctuation"},","),t("newChildren"),s("span",{class:"token punctuation"},"["),t("i"),s("span",{class:"token punctuation"},"]"),s("span",{class:"token punctuation"},","),t("container"),s("span",{class:"token punctuation"},","),t(" oldStartVNode"),s("span",{class:"token punctuation"},"."),t("el"),s("span",{class:"token punctuation"},")"),t("\n  "),s("span",{class:"token punctuation"},"}"),t("\n"),s("span",{class:"token punctuation"},"}"),t("\n")])])]),s("p",null,"接着处理删除情况，如果旧节点开始下标小于旧节点技术下标，需要把多余的节点删除，因此增加判断"),s("div",{class:"language-javascript"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"else"),t(),s("span",{class:"token keyword"},"if"),s("span",{class:"token punctuation"},"("),t("oldStartIdx "),s("span",{class:"token operator"},"<="),t(" oldEndIdx "),s("span",{class:"token operator"},"&&"),t(" newStartIdx "),s("span",{class:"token operator"},">"),t(" newEndIdx"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n   "),s("span",{class:"token keyword"},"for"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"let"),t(" i "),s("span",{class:"token operator"},"="),t(" oldStartIdx"),s("span",{class:"token punctuation"},";"),t(" i "),s("span",{class:"token operator"},"<="),t(" oldEndIdx"),s("span",{class:"token punctuation"},","),t(" i"),s("span",{class:"token operator"},"++"),s("span",{class:"token punctuation"},")"),t(),s("span",{class:"token punctuation"},"{"),t("\n     "),s("span",{class:"token function"},"unmount"),s("span",{class:"token punctuation"},"("),t("oldChildren"),s("span",{class:"token punctuation"},"["),t("i"),s("span",{class:"token punctuation"},"]"),s("span",{class:"token punctuation"},")"),t("\n   "),s("span",{class:"token punctuation"},"}"),t("\n"),s("span",{class:"token punctuation"},"}"),t("\n")])])])])],-1)];e.render=function(s,t,o,e,c,l){return n(),a("div",null,p)};export{o as __pageData,e as default};
