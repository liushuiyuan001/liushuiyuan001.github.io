<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、CDN | liushuiyuan's Blog</title>
    <meta name="description" content="我的vitepress博客.">
    <link rel="stylesheet" href="/assets/style.cac40d77.css">
    <link rel="modulepreload" href="/assets/Home.c5d3b19b.js">
    <link rel="modulepreload" href="/assets/app.f15b287e.js">
    <link rel="modulepreload" href="/assets/js_Performance.md.8490174a.lean.js">
    <link rel="modulepreload" href="/assets/app.f15b287e.js">
    <link rel="icon" href="/img/linktolink.png">
    <meta name="twitter:title" content="一、CDN | liushuiyuan&#39;s Blog">
    <meta property="og:title" content="一、CDN | liushuiyuan&#39;s Blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="liushuiyuan&#39;s Blog, back to home" data-v-675d8756 data-v-4a583abe><!----> liushuiyuan&#39;s Blog</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/about/" data-v-b8818f8c>关于 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/about/" data-v-b8818f8c>关于 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/">Vue</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/PROP1">Vue组件间传值(上)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/PROP2">Vue组件间传值(下)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue/PAGE">页面间传值</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/BASE">JS</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Map">Map</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Code">手写代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/js/Performance">性能优化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Brower">浏览器原理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Http304">浏览器缓存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Interview-base">面试</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Interview-yl">面试</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Interview-wy">面试</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Interview-wy1">面试</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/js/Interview-hk">面试</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/design/index">Head First Design</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/design/chapter01">策略模式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/design/chapter02">观察者模式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/design/chapter03">装饰者模式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/design/chapter04">简单工厂</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/design/chapter05">抽象工厂模式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/design/chapter06">命令模式</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h3 id="一、cdn" tabindex="-1">一、CDN <a class="header-anchor" href="#一、cdn" aria-hidden="true">#</a></h3><br><h4 id="_1-cdn的概念" tabindex="-1">1. CDN的概念 <a class="header-anchor" href="#_1-cdn的概念" aria-hidden="true">#</a></h4><p>CDN(Content Delivery Network, 内容分发网络) 是指一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序以及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。</p><ol><li>典型的CDN系统由下面三个部分组成：</li></ol><ul><li>分发服务系统：最基本的工作单元就是Cache设置，cache(边缘cache) 负责直接响应最终用户的访问请求，把缓存在本地的内容快速地提供给用户。同时cache还负责与源站点进行内容同步，把更新的内容以及本地没有的内容从源站点获取并保存在本地。Cache设备的数据、规模、总服务能力是衡量一个CDN系统服务能力的最基本的指标。</li><li>负载均衡系统：主要功能是负责对所有发起服务请求的用户进行访问调度，确定提供给用户的最终实际访问地址。两级调度体系分为全部负载均衡和本地负载均衡。全局负载均衡主要根据用户就进性原则，通过对每个服务节点进行“最优”判断，确定向用户提供服务的cache的物理位置。本地负载均衡主要负责节点内部的设备负载均衡</li><li>运营管理系统：运营管理系统分为运营管理和网络管理子系统，负责处理业务层面的与外界系统交互所必须的收集、整理、交付工作，包含客户管理、产品管理、计费管理、统计分析等功能。</li></ul><ol start="2"><li><p>CDN的作用</p><p>(1) 在性能方法，引入CDN的作用在于</p><ul><li>用户收到的内容来自最近的数据中心，延迟更低，内容加载更快</li><li>部分资源请求分配给了CDN，减少了服务器的负载</li></ul><p>(2) 在安全方面，CDN有助于防御DDos、MITM等网络攻击</p><ul><li>针对DDoS: 通过监控分析异常流量，限制其请求频率</li><li>针对MITM：从源服务器到CDN节点到ISP，全链路HTTPS通信</li></ul><p>除此之外，CDN作为一种基础的云服务，同样具有资源托管、按需扩展(能够应对流量高峰) 等方面的优势。</p></li></ol><h3 id="二、懒加载" tabindex="-1">二、懒加载 <a class="header-anchor" href="#二、懒加载" aria-hidden="true">#</a></h3><h4 id="懒加载与预加载的区别" tabindex="-1">懒加载与预加载的区别 <a class="header-anchor" href="#懒加载与预加载的区别" aria-hidden="true">#</a></h4><ul><li>懒加载也叫延迟加载，指的是在长网页中延迟加载图片的时机，当用户需要访问时，再去加载</li><li>预加载指的是将所需的资源提前请求加载到本地，这样后面在需要用到时就直接从缓存中获取资源</li></ul><h4 id="懒加载的代码实现" tabindex="-1">懒加载的代码实现 <a class="header-anchor" href="#懒加载的代码实现" aria-hidden="true">#</a></h4><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
<span class="token comment">//用来判断bound.top&lt;=clientHeight的函数，返回一个bool值</span>
<span class="token keyword">function</span> <span class="token function">isIn</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> bound <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> clientHeight <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
        <span class="token keyword">return</span> bound<span class="token punctuation">.</span>top <span class="token operator">&lt;=</span> clientHeight<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> source <span class="token operator">=</span> el<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
            el<span class="token punctuation">.</span>src <span class="token operator">=</span> source<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isIn</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">loadImg</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span>onload <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function-variable function">onscroll</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//onscroll()在滚动条滚动的时候触发</span>
			<span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="三、回流与重绘" tabindex="-1">三、回流与重绘 <a class="header-anchor" href="#三、回流与重绘" aria-hidden="true">#</a></h3><ol><li><p>回流与重绘的概念及触发条件</p><p>(1) 回流</p><p>当渲染树种部分或者全部元素的尺寸、构造或者属性发生变化时，浏览器会重新渲染部分或者全部</p></li></ol><p>文档的过程就称为回流。下面这些操作会导致回流：</p><ul><li>页面的首次渲染</li><li>浏览器的窗口大小发生变化</li><li>元素的内容发生辩护</li><li>元素的尺寸或者位置发生辩护</li><li>元素的字体大小发生辩护</li><li>激活css伪类</li><li>查询某些属性或者调用某些方法</li><li>添加或者删除可见的DOM元素</li></ul><p>在触发回流的时候，由于浏览器渲染页面是基于流式布局，所以当触发回流时，会导致周围的DOM元素重新排列，它的影响范围有两种：</p><ul><li><p>全局范围：从根节点开始，对整个渲染树进行重新布局</p></li><li><p>局部范围：对渲染树的某部分或者一个渲染对象进行重新布局</p><p>(2) 重绘</p><p>当页面中某些元素的样式发生变化，但是不会影响其在文档流中的位置时，浏览器就会对元素进行重新绘制，这个过程就是重绘。下面这些操作会导致回流：</p></li><li><p>color、background相关属性：background-image等</p></li><li><p>outline相关属性：outline-color outline-width text-decoration</p></li><li><p>border-radius、visibility、 box-shadow</p><p>注意：当触发回流时，一定会触发重绘，但是重绘不一定会引发回流</p></li></ul><ol start="2"><li>如何避免回流与重绘？</li></ol><ul><li><p>操作DOM时，尽量在低层级的DOM节点进行操作</p></li><li><p>不要使用table布局，一个小的改动可能会使整个table进行重新布局</p></li><li><p>使用CSS的表达式</p></li><li><p>不要频繁操作DOM，可以创建一个文档片段documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档这种</p></li><li><p>将元素先设置display:none 操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM的操作不会引发回流和重绘</p></li><li><p>将DOM的多个读操作(或者写操作)放在一起，而不是读写操作穿件插着写。这得益于浏览器的渲染队列机制。</p><p>浏览器针对页面的回流与重绘，进行了自身的优化--渲染队列</p><p>浏览器会将所有的回流、重绘的操作放在一个队列中，当队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会对队列进行批处理。这样就会让多次的回流、重绘变成一次回流重绘。</p></li></ul><ol start="3"><li><p>如何优化动画</p><p>对于如何优化动画，我们知道，一般情况下。动画需要频繁的操作DOM，就会导致页面的性能问题，我们可以将动画的position属性设置为absolute或者fixed，将动画脱离文档流，这样他的回流就不会影响到页面了</p></li><li><p>documentFragment是什么？用它跟直接操作DOM的区别是什么？</p><p>当我们把一个DocumentFRagment节点插入文档树时，插入的不是DocumentFragment自身，而是它的所有子孙节点。在频繁的DOM操作时，我们就可以将DOM元素插入DocumentFragment，之后一次性的将所有的子孙节点插入文档中，和直接操作DOM相比，将DocumentFragment节点插入DOM树时，不会触发页面的重绘，这样就大大提高了页面的性能。</p></li></ol><h3 id="四、节流与防抖" tabindex="-1">四、节流与防抖 <a class="header-anchor" href="#四、节流与防抖" aria-hidden="true">#</a></h3><ol><li><p>对节流与防抖的理解</p><ul><li>函数防抖是指在事件被触发n秒后再执行回调，如果在这n秒内事件又被触发，则重新计时。这可以使用在一些点击请求的事件上，避免因为用户的多次点击向后端发送多次请求。</li><li>函数节流是指规定一个单位时间，在这个单位时间内，只能有一次触发事件的回调函数执行，如果在同一个单位时间内某事件被触发多次，只有一次能生效。节点可以使用在scroll函数的事件监听上, 通过事件节点来降低事件调用的频率。</li></ul></li><li><p>防抖节流函数的应用场景</p><p>防抖</p><ul><li>输入框搜索场景：用户搜索后需要请求后端接口，只执行最后输入的值</li><li>按钮提交场景：防止多次提交按钮，只执行最后提交的一次</li><li>服务端验证场景：表单验证需要服务端配合，只执行一段连续的输入事件的最后一次</li></ul><p>节流</p><ul><li>拖拽场景：固定事件内只执行一次，防止超高频次触发位置变动</li><li>缩放场景：监控浏览器resize</li><li>动画场景：避免短时间内多次触发动画引起性能问题</li></ul></li><li><p>实现节流函数和防抖函数</p><p>函数防抖的实现</p><div class="language-javascript"><pre><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>wait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span>

        <span class="token comment">// 如果此时存在定时器的话，则取消之前的定时器重新记时</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
            timer <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 设置定时器 使事件间隔指定时间后执行</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数节流的实现</p><div class="language-javascript"><pre><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
                timer <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 时间戳版</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> preTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span>
        <span class="token keyword">let</span> nowTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// 如果两次时间间隔超过了指定时间，则执行函数</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>nowTime <span class="token operator">-</span> preTime <span class="token operator">&gt;=</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            preTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>防抖+节流</p><p>防抖有时候因为触发太过频繁， 导致一次响应都没有。所以希望固定的事件必定给用户一个响应，于是就有了防抖+节点的操作</p><div class="language-javascript"><pre><code><span class="token comment">// 防抖+节流</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>now <span class="token operator">-</span> last <span class="token operator">&lt;</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
                timer <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span>
            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这个时候表示时间到了 必须给响应</span>
            last <span class="token operator">=</span> now
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="五、图片优化" tabindex="-1">五、图片优化 <a class="header-anchor" href="#五、图片优化" aria-hidden="true">#</a></h3><ol><li><p>如何对项目中的图片进行优化</p><ul><li><p>不用图片。很多时候会使用很多修饰类图片，其实这类修饰图片完全可以用CSS去代替</p></li><li><p>对于移动端来说，屏幕宽度就那么点，完全没有必要去加载原图浪费带宽。一般图片都用CDN加载，可以计算出适配屏幕的宽度，然后去请求相应裁剪好的图片。</p></li><li><p>小图使用base64格式</p></li><li><p>将多个图标文件整合到一张图片中（雪碧图）</p></li><li><p>选择正确的图片格式：</p><p>对于能够显示WebP格式的浏览器尽量使用WebP格式。因为WebP格式具有更好的图像压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量，缺点就是兼容性并不好</p><p>小图使用PNG其实对于大部分图标这类图片，完全可以使用SVG代替</p><p>照片使用JPEG</p></li></ul></li></ol><h3 id="六、webpack优化" tabindex="-1">六、Webpack优化 <a class="header-anchor" href="#六、webpack优化" aria-hidden="true">#</a></h3><ol><li><p>如何提高webpack的打包速度</p><ul><li><p>优化Loader</p><p>对于Loader来说，影响打包效率首当其冲必属Babel。因为Babel会将代码转为字符串生成AST，然后对AST继续进行转变最后再生成新的代码，代码越大，转换代码越多，效率就越低。</p><p>首先我们优化Loader的文件搜索范围</p><div class="language-javascript"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// js 文件才使用 babel</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// 只在 src 文件夹下查找</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 不会去查找的路径</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于Babel来说，希望只作用在JS代码上的，然后node_modules中使用的代码都是编译过的，所以完全没有必要再去处理一遍。</p><p>当然这样做还不够，还可以将Babel编译过的文件缓存起来，下次只需要编译更改过的代码文件即可，这样可以大幅度加快打包时间</p><div class="language-javascript"><pre><code>loader<span class="token operator">:</span> <span class="token string">&#39;babel-loader?cacheDirectory=true&#39;</span>
</code></pre></div></li><li><p>HappyPack</p><p>受限于Node是单线程运行的，所以Webpack在打包的过程中也是单线程的，特别是在执行Loader的时候，长时间编译的任务很多，这样就会导致等待的情况。</p><p>HappyPack 可以将Lader的同步执行转换为并行的，这样就能充分利用系统资源来加快打包效率了</p><div class="language-javascript"><pre><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token comment">// id 后面的内容对应下面</span>
      loader<span class="token operator">:</span> <span class="token string">&#39;happypack/loader?id=happybabel&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&#39;happybabel&#39;</span><span class="token punctuation">,</span>
    loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-loader?cacheDirectory&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 开启 4 个线程</span>
    threads<span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div></li><li><p>DIIPlugin</p><p>DIIPligin 可以将特定的类库提前打包然后引入。这种方式可以极大的减少打包类库的次数，只有当类库更新版本才有需要重新打包，并且也实现了将公共代码抽离成单独文件的优化方案。DIIPlugin的使用方法如下：</p><div class="language-javascript"><pre><code><span class="token comment">// 单独配置在一个文件中</span>
<span class="token comment">// webpack.dll.conf.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 想统一打包的类库</span>
    vendor<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&#39;[name].dll.js&#39;</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">&#39;[name]-[hash]&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// name 必须和 output.library 一致</span>
      name<span class="token operator">:</span> <span class="token string">&#39;[name]-[hash]&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 该属性需要与 DllReferencePlugin 中一致</span>
      context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;[name]-manifest.json&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后需要执行这个配置文件生成依赖文件，接下来需要使用DllReferencePlugin将依赖文件引入项目中</p><div class="language-javascript"><pre><code><span class="token comment">// webpack.conf.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...省略其他配置</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
      <span class="token comment">// manifest 就是之前打包出来的 json 文件</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/vendor-manifest.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>代码压缩</p><p>在webpack3中，一般使用UglifyJS来压缩代码，但是这个是单线运行的，为了加快效率，可以使用webpack-parllel-uglify-plugin来并行运行UglifyJS，从而提高效率。</p><p>在webpack4中，不需要以上这些操作了，只需要将mode设置为production就可以默认开始以上功能。代码压缩也是我们必做的性能优化方案，当然我们不止可以压缩JS代码，还可以压缩HTML、CSS代码，并且在压缩JS代码的过程中，我们还可以通过配置实现比如删除console.log这类代码的功能。</p></li><li><p>其他</p><p>可以通过一些小的优化点来加快打包速度</p><p>resolve.extensions: 用来表面文件后缀列表，默认查找顺序是[&#39;.js&#39;,&#39;.json&#39;], 如果你的导入文件没有添加后缀就会按照这顺序查找文件。我们应该尽可能减少后缀列表长度，然后将出现频率高德后缀排在前面</p><p>resolve.alias: 可以通过别名的方式来映射一个路径，能让Webpack更快找到路径</p><p>module.noParse: 如果你确定一个文件下没有其他依赖，就可以使用该属性让Webpack不扫描该文件，这种方式对于大型的类库很有帮助</p></li></ul></li><li><p>如何减少Webpack打包体积</p><ul><li>按需加载</li></ul><p>在开发SPA项目的时候，项目中都会存在很多路由界面。如果将这些页面全部打包进一个JS文件的话，虽然将 多个请求合并了，但是同样也加载了很多并不需要的代码，耗费了更长的时间。那么为了页面能更快地呈现给用户，希望首页能加载的文件体积越小越好，这时候就可以按需加载，将每个路由页面单独打包为一个文件。当然不仅仅路由可以按需加载，对于loadash这种大型类型同样可以使用这个功能。</p><p>按需加载的代码实现这里就不详细展开了，因为鉴于用的框架不同，实现起来都是不一样的。当然了，虽然他们的用法可能不同，但是底层的机制都是一样的。都是当使用的时候再去下载对应文件，返回一个Promise，当Promise成功以后执行回调。</p><ul><li>Scope Hoisting</li></ul><p>Scope Hoisting 会分析出模板之间的依赖关系，尽可能的把打包出来的模块合并到一个函数中去。</p><p>如果在webpack4中你希望开启这个功能，只需要启用optimization.concatenateMudules 就可以了</p></li></ol><div class="language-javascript"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    concatenateModules<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Tree Shaking</p><p>Tree Shaking 可以实现删除项目中未被引用的代码，比如：</p><div class="language-javascript"><pre><code><span class="token comment">// test.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./test.js&#39;</span>
</code></pre></div><p>对于以上情况， test 文件中的变量b如果没有在项目中使用到的话，就不会被打包到文件中。如果使用Webpack4的话，开启生产环境就会自动启动这个优化功能。</p><ol start="3"><li><p>如何用webpack来优化前端性能？</p><p>用webpack优化前端性能是值优化webpack的输出结果，让打包的最终结果在浏览器运行快速高校</p><ul><li>压缩代码：删除多余的代码、注释、简化代码的代码的写法等等方式。可以利用css-loader?minimize 来压缩css</li><li>利用CDN加速：在构建过程中，将引用的静态资源路径修改为CDN上对应的路径。可以利用webpack对应output参数和各loader的publicPath参数来修改资源路径</li><li>Tree Shaking：将代码中永远不会走到的片段删除掉。可以通过在启动webpack时追加参数 --optimize-minimize 来实现</li><li>Code Splitting：将代码按路由维度或者组件分块chunk，这样做到按需加载，同时可以充分利用浏览器缓存</li><li>提取公共第三方库：SplitChunksPlugin插件来进行公共模块抽取，利用浏览器缓存可以长期缓存这些无需频繁变动的公共代码</li></ul></li><li><p>如何提高webpack的构建速度</p><ul><li>多入口情况下，使用CommonsChunkPlugin来提取公共代码</li><li>通过externals配置来提取常用库</li><li>利用DIIPlugIn和DIIReferencePlugin预编译资源模块 通过DIIPlugin来对那些我们引用但是绝对不会修改的npm包来进行预编译，再通过DIIReferencePlugin将预编译的模块加载尽量。</li><li>使用Happypack实现多线程加速编译</li><li>使用webpack-uglify-parallel来提示uglifyPlugin的压缩速度。原理上webpack-uglify-parallel采用了多核并行压缩来提示压缩速度</li><li>使用Tree-shaking和Scope Hoisting来剔除多余代码</li></ul></li></ol></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/js/Code" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>手写代码</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/js/Brower" data-v-38ede35f><span class="text" data-v-38ede35f>浏览器原理</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"33b11600\",\"design_chapter01.md\":\"a23abc29\",\"design_chapter02.md\":\"337b834c\",\"design_chapter03.md\":\"1b001010\",\"design_chapter04.md\":\"942ce95b\",\"design_chapter05.md\":\"1682f2bf\",\"design_chapter06.md\":\"1133529f\",\"design_index.md\":\"43e57f4c\",\"about_index.md\":\"200d01d5\",\"js_base.md\":\"bac71f65\",\"js_brower.md\":\"20a32596\",\"js_code.md\":\"3565ea77\",\"js_css.md\":\"5857ba8e\",\"js_http304.md\":\"ae89475c\",\"js_interview-base.md\":\"3757ff14\",\"js_interview-hk.md\":\"785c8d03\",\"js_interview-wy.md\":\"2678ba58\",\"js_interview-wy1.md\":\"4757a5a9\",\"js_interview-yl.md\":\"5bbad3c9\",\"js_js.md\":\"5fba7869\",\"js_map.md\":\"198c759e\",\"js_performance.md\":\"8490174a\",\"js_react.md\":\"2f301ccf\",\"vue_page.md\":\"cdcfb26f\",\"vue_prop1.md\":\"c2b2f594\",\"vue_prop2.md\":\"60586a53\",\"vue_index.md\":\"42e78b11\"}")</script>
    <script type="module" async src="/assets/app.f15b287e.js"></script>
  </body>
</html>